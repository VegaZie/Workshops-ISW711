<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <select
      name="countries"
      id="countries"
      onchange="ExchangeCurrency()"
    ></select>

    <div>
      <label>Exchange rate against the Dollar and the Euro</label>
      <br />
      <br />
      <label>USD: </label>
      <span id="dollarExc"></span>
      <br />
      <br />
      <label>EUR: </label>
      <span id="euroExc"></span>
    </div>

    <script>
      const ajaxRequest = new XMLHttpRequest(); //AJAX
      ajaxRequest.addEventListener("load", (e) => {
        const countries = JSON.parse(e.target.responseText);
        const paises = countries.paises;
        paises.sort((x, y) => x.name.localeCompare(y.name));
        let optionsHtml = "";
        paises.forEach((country) => {
          optionsHtml += `<option value="${country.currency}">${country.name}</option>`;
        });
        document.getElementById("countries").innerHTML = optionsHtml;
        ExchangeCurrency();
      });
      ajaxRequest.addEventListener("error", () => {});
      ajaxRequest.open("GET", "http://localhost:3000/paises");
      ajaxRequest.send();

      function ExchangeCurrency() {
        let curren = document.getElementById("countries").value;
        let currency = curren.toLowerCase();

        const ajaxRequest1 = new XMLHttpRequest(); //AJAX
        ajaxRequest1.addEventListener("load", (e) => {
          const currenciesList = JSON.parse(e.target.responseText);
          const currencies = currenciesList[currency];

          document.getElementById("dollarExc").innerHTML = currencies["usd"];
          document.getElementById("euroExc").innerHTML = currencies["eur"];
        });
        ajaxRequest1.addEventListener("error", () => {});
        ajaxRequest1.open(
          "GET",
          "https://cdn.jsdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies/" +
            currency +
            ".json"
        );
        ajaxRequest1.send();
      }
    </script>
  </body>
</html>